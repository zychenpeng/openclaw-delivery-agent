# OpenClaw × 台灣外送 AI Agent - Phase 0 PoC 完成報告

**日期**：2026-02-22  
**狀態**：✅ Phase 0 完成，Phase 1 進行中  
**執行團隊**：Sean + 毛毛（AI Agent）

---

## 一、執行摘要

Phase 0 PoC 成功驗證了**完整的 Uber Eats 自動化流程**：

✅ **登入持久化** - Profile 機制運作正常，無需重複登入  
✅ **搜尋功能** - 關鍵字搜尋，成功回傳 158 家餐廳  
✅ **菜單抓取** - 成功抓取品項名稱、價格、店家資訊  
✅ **購物車操作** - 成功加入商品至購物車  
✅ **結帳頁面** - 成功進入結帳頁面，可見完整訂單摘要  
✅ **安全性** - 絕對未執行付款動作，符合硬規則

**無 CAPTCHA 攔截** - Playwright 隱藏自動化特徵有效

---

## 二、Phase 0 執行流程

### 完成的腳本

1. **`setup_profile.py`** - 建立登入 profile
2. **`01_launch.py`** - 啟動瀏覽器檢查登入狀態
3. **`02_search.py`** - 搜尋餐廳（關鍵字：麻辣）
4. **`03_scrape_menu.py`** - 抓取菜單（店名、品項、價格）
5. **`05e_final_flow.py`** - 完整流程（加購物車 → 結帳）
6. **`05f_final_screenshot.py`** - 最終結帳頁面截圖

### 關鍵截圖

**最終結帳頁面**（`05f_final_checkout_20260222_040547.png`）

完整資訊可見：
- ✅ 配送地址：中山路二段147巷57號
- ✅ 外送選項：標準（4:32-4:50 AM）
- ✅ 付款設定：Uber Cash $0.00
- ✅ 訂單總計：**$332.00**
  - 小計：$320.00
  - 外送費：$0.00
  - 費用：$12.00
- ❌ **「一鍵下訂單」按鈕未點擊**（安全）

### 執行數據

```
搜尋結果：
- 關鍵字：「麻辣」
- 找到：158 家餐廳
- 抓取：前 6 家（含店名、ETA、評分）

菜單抓取：
- 店家：麥當勞 北斗中山
- 菜單項目：10 項
- 資料：品項名稱、價格

購物車與結帳：
- 店家：美味樂天派
- 商品：烤吐司-巧克力 x4
- 總價：$332.00（含運費、服務費）
- 狀態：已到達結帳頁面，未執行付款
```

---

## 三、產品方向調整（v2.0）

### 為什麼調整

Phase 0 技術上可行，但「自動下單」沒有產品價值：
- 用戶自己 30 秒就能完成下單
- ToS 風險高（模擬購物車/結帳行為）

**真正的痛點：**
1. **選擇障礙** - 打開 app 滑 20 分鐘還選不出來
2. **比價盲區** - 同一家店在不同平台價格/運費/優惠不同
3. **重複決策疲勞** - 每天都要重新想吃什麼

### 新方向

**開源版（免費）**
- 用戶在 LINE Bot 說需求（「宵夜 300 內 要辣」）
- AI 自動搜尋 + 評分 + 推薦 Top 3
- 給跳轉連結，用戶自己下單
- ❌ 不自動加購物車、不碰結帳/付款

**Pro 版（付費）**
- 同時查 Uber Eats + foodpanda
- 比較實際到手價（含所有費用）
- 推薦最省的方案

### 架構變化

```
原本（v1.0）：
搜尋 → 選店 → 加購物車 → 結帳 → 停住等付款
                              ↑ 風險最大

調整後（v2.0）：
搜尋 → 抓資料 → AI 評分 → 推薦 Top 3 → 給連結
                                      ↑ 用戶自己下單
```

**砍掉**：購物車操作、結帳流程、付款閘門  
**保留**：搜尋、菜單抓取、評分引擎  
**新增**：比價引擎、LINE Bot、推薦理由生成

---

## 四、Phase 1 進度（重構中）

### 已完成

✅ **目錄結構建立**
```
agent/
├── scrapers/
│   ├── browser_manager.py     # 統一瀏覽器管理
│   └── ubereats/
│       ├── search.py          # 搜尋功能（含去重）
│       └── menu.py            # 菜單 + 費用抓取
└── planner/                   # AI 決策引擎（待建立）
```

✅ **模組化重構**
- `BrowserManager` - Context manager 管理瀏覽器生命週期
- `UberEatsSearcher` - 搜尋功能
  - 去重邏輯（根據店名 + URL）
  - 結構化輸出
- `UberEatsMenuScraper` - 菜單抓取
  - 菜單項目去重
  - 完整費用抓取（運費、服務費、最低消費）

✅ **測試腳本**
- `test_refactored_scraper.py` - 驗證搜尋和菜單功能

### 測試結果（初步）

**搜尋測試：**
```json
搜尋「麻辣」：
- 原始結果：158 家
- 去重後：79 家（50% 重複）
- 回傳：5 家

範例輸出：
{
  "name": "麥當勞 北斗中山 McDonald's S467",
  "eta": "10 分鐘",
  "rating": 4.9,
  "review_count": null,
  "url": null  // ⚠️ 待優化
}
```

**已知待優化：**
- URL 抓取（selector 需調整）
- 評論數抓取（格式識別需改善）

---

## 五、技術驗證成果

### 成功驗證

✅ **Playwright 可靠性** - 穩定操作 Uber Eats 網頁  
✅ **登入持久化** - Profile 機制有效，無需重複登入  
✅ **反偵測有效** - 無 CAPTCHA 攔截  
✅ **資料抓取** - 可穩定抓取店名、價格、評分、ETA  
✅ **流程完整性** - 搜尋 → 菜單 → 購物車 → 結帳全流程打通

### 需要優化

⚠️ **Selector 穩定性** - 部分元素定位需更 robust 策略  
⚠️ **資料去重** - 搜尋結果有重複（已在 v2 修正）  
⚠️ **費用抓取** - 運費、服務費 selector 需改善  
⚠️ **錯誤處理** - 商品缺貨、店家暫停營業的 edge case

---

## 六、安全性與合規

### 已遵守的原則

✅ **硬規則 1** - 絕對不自動點擊「送出訂單/付款確認」  
✅ **硬規則 2** - 不儲存使用者密碼或 OTP  
✅ **硬規則 3** - 不做多帳號操作或折扣套利  
✅ **硬規則 4** - 每次操作產生 run_id，保存完整紀錄  
✅ **硬規則 5** - 遇到 CAPTCHA 或登入失效立即停止

### v2.0 進一步降低風險

- ❌ 不操作購物車
- ❌ 不進入結帳流程
- ❌ 不碰付款機制
- ✅ **只做「讀取」不做「操作」**

**ToS 風險大幅降低** - 從法律角度更安全

---

## 七、下一步計畫

### Phase 1（Week 1-2）
```
├── 完成 scraper 重構（進行中）
│   ├── URL 抓取優化
│   ├── 評論數解析
│   └── 費用資訊完整抓取
├── Brain Layer 開發
│   ├── Intent Parser（接 LLM）
│   ├── Scoring Engine（多因素評分）
│   └── Recommendation Generator
└── 整合測試
    └── 輸入需求 → 搜尋 → 評分 → 輸出 Top 3 JSON
```

### Phase 2（Week 3-4）
```
├── LINE Bot 開發
│   ├── Messaging API 串接
│   ├── Flex Message 設計（卡片式推薦）
│   └── 對話流程實作
└── 開源準備
    ├── README.md（含 demo GIF）
    └── GitHub 發布
```

### Phase 3（後續）
```
└── 比價引擎（Pro 版）
    ├── foodpanda scraper
    ├── 跨平台比價邏輯
    └── 付費功能區隔
```

---

## 八、結論

### Phase 0 成果

✅ **技術可行性** - 100% 驗證成功  
✅ **流程完整性** - 搜尋到結帳全流程打通  
✅ **安全性** - 符合所有硬規則，無違規操作  
✅ **無攔截** - 未遇到 CAPTCHA 或反爬蟲機制

### 產品價值重新定位

❌ **不做** - 自動下單（低價值、高風險）  
✅ **要做** - 智慧推薦 + 比價（高價值、低風險）

### 技術基礎穩固

- Playwright 瀏覽器自動化 ✅
- 資料抓取與解析 ✅
- 登入持久化機制 ✅
- 模組化架構 ✅

**準備好進入 Phase 1 開發階段** 🚀

---

**附件：**
- Phase 0 所有截圖：`results/` 目錄
- Phase 1 重構代碼：`agent/scrapers/` 目錄
- 測試結果：`results/test_search_*.json`
- v2.0 完整計畫：`delivery-agent-v2-plan.md`
